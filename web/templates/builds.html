{{define "title"}}Build Status{{end}}

{{define "extra-css"}}<link rel="stylesheet" href="/static/builds.css">{{end}}

{{define "stats"}}
<div class="stats">
    Last updated: {{.LastUpdate.Format "Jan 2, 15:04:05 MST"}} |
    Repositories: {{len .Repositories}}
</div>
{{end}}

{{define "branch-section"}}
<div class="branch-section">
    <div class="branch-header">
        <span class="branch-name">{{.Branch}}</span>
        {{if .HasChecks}}
        <div class="latest-status">
            <span role="img" class="status-icon {{.StatusClass}}" aria-label="{{.OverallStatus}}"></span>
            <span>{{.OverallStatus}}</span>
        </div>
        {{end}}
    </div>

    {{if .HasChecks}}
    <div class="runs-matrix">
        {{range .Checks}}
        <a href="{{.URL}}" target="_blank" rel="noopener noreferrer"
           aria-label="{{.Name}}: {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}Running{{else if eq .Conclusion "cancelled"}}Cancelled{{else}}{{.Conclusion}}{{end}}"
           data-tooltip="{{.Name}}: {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}Running{{else if eq .Conclusion "cancelled"}}Cancelled{{else}}{{.Conclusion}}{{end}}"
           class="run-dot {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}status-running{{else if or (eq .Conclusion "failure") (eq .Conclusion "timed_out") (eq .Conclusion "action_required") (eq .Conclusion "cancelled")}}status-failure{{else if eq .Conclusion "success"}}status-success{{else}}status-neutral{{end}}">
        </a>
        {{end}}
    </div>
    <div class="checks-summary">
        {{if gt .SuccessCount 0}}<span class="check-count success">{{.SuccessCount}} passed</span>{{end}}
        {{if gt .FailureCount 0}}<span class="check-count failure">{{.FailureCount}} failed</span>{{end}}
        {{if gt .RunningCount 0}}<span class="check-count running">{{.RunningCount}} running</span>{{end}}
    </div>
    {{else}}
    <div class="no-runs">No recent checks</div>
    {{end}}
</div>
{{end}}

{{define "content"}}
{{if not .Repositories}}
<div class="empty-state">
    <p>No build status data available yet.</p>
    {{if .LastUpdate.IsZero}}<p class="empty-state-hint">Data is still loading. Check back shortly.</p>{{end}}
</div>
{{else}}
<div class="build-cards">
    {{range .Repositories}}
    <div class="build-card">
        <div class="card-header">
            <h3 class="repo-name">
                <a href="https://github.com/{{$.Organization}}/{{.Name}}" target="_blank" rel="noopener noreferrer">{{.Name}}</a>
            </h3>
        </div>

        {{template "branch-section" .MainBranch}}
        {{template "branch-section" .DevelopBranch}}
    </div>
    {{end}}
</div>
{{end}}
{{end}}
