{{define "title"}}Pull Requests{{end}}

{{define "extra-css"}}{{end}}

{{define "stats"}}
<div class="stats">
    Last updated: {{.LastUpdate.Format "Jan 2, 15:04:05 MST"}} |
    Total PRs: {{.TotalPRs}} |
    Showing {{if .PullRequests}}{{add (mul (add .CurrentPage -1) 100) 1}}-{{add (mul (add .CurrentPage -1) 100) (len .PullRequests)}}{{else}}0{{end}} of {{.TotalPRs}}
</div>
{{if .RepoNames}}
<form class="filter-form" id="repo-filter-form" method="get">
    <input type="hidden" name="sort" value="{{.Sort}}">
    <input type="hidden" name="order" value="{{.Order}}">
    <label for="repo-filter" class="sr-only">Filter by repository</label>
    <select id="repo-filter" name="repo">
        <option value="">All repositories</option>
        {{range .RepoNames}}
        <option value="{{.}}"{{if eq . $.Repo}} selected{{end}}>{{.}}</option>
        {{end}}
    </select>
</form>
{{end}}
{{end}}

{{define "content"}}
{{if eq .TotalPRs 0}}
<div class="empty-state">
    <p>No open pull requests found across monitored repositories.</p>
    {{if .LastUpdate.IsZero}}<p class="empty-state-hint">Data is still loading. Check back shortly.</p>{{end}}
</div>
{{else}}
<div class="issues-table pr-table-wrap">
    <table class="pr-table">
        <caption class="sr-only">Open pull requests across repositories</caption>
        <colgroup>
            <col class="col-repo">
            <col class="col-title">
            <col class="col-author">
            <col class="col-branch">
            <col class="col-review">
            <col class="col-merge">
            <col class="col-updated">
        </colgroup>
        <thead>
            <tr>
                <th scope="col" aria-sort="{{if eq .Sort "repo"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=repo&order={{if and (eq .Sort "repo") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Repository
                        <span class="sort-arrow {{if eq .Sort "repo"}}active{{end}}">
                            {{if and (eq .Sort "repo") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "repo") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "title"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=title&order={{if and (eq .Sort "title") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Title
                        <span class="sort-arrow {{if eq .Sort "title"}}active{{end}}">
                            {{if and (eq .Sort "title") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "title") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" class="col-author" aria-sort="{{if eq .Sort "author"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=author&order={{if and (eq .Sort "author") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Author
                        <span class="sort-arrow {{if eq .Sort "author"}}active{{end}}">
                            {{if and (eq .Sort "author") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "author") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" class="col-branch">Branch</th>
                <th scope="col">Review</th>
                <th scope="col">Merge</th>
                <th scope="col" aria-sort="{{if eq .Sort "updated"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=updated&order={{if and (eq .Sort "updated") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Updated
                        <span class="sort-arrow {{if eq .Sort "updated"}}active{{end}}">
                            {{if and (eq .Sort "updated") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "updated") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
            {{range .PullRequests}}
            <tr{{if index $.StaleRepos .Repository}} class="stale-row"{{end}}>
                <td data-label="Repository">{{.Repository}} <span class="issue-number">#{{.Number}}</span></td>
                <td data-label="Title" title="{{.Comments}} comments, {{.ReviewComments}} review comments">
                    <div class="pr-title-text">
                        <a href="{{.URL}}" target="_blank" rel="noopener noreferrer">
                            {{if .Draft}}<span class="draft-badge">Draft</span> {{end}}{{.Title}}
                        </a>
                    </div>
                    {{if .Labels}}
                    <div class="labels">
                        {{range .Labels}}
                        <span class="label" style="{{.LabelStyle}}">{{.Name}}</span>
                        {{end}}
                    </div>
                    {{end}}
                    {{if .Checks}}
                    <div class="checks-container">
                        <div class="checks-matrix">
                            {{range .Checks}}
                            <a href="{{.URL}}" target="_blank" rel="noopener noreferrer"
                               aria-label="{{.Name}}: {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}Running{{else if eq .Conclusion "cancelled"}}Cancelled{{else}}{{.Conclusion}}{{end}}"
                               data-tooltip="{{.Name}}: {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}Running{{else if eq .Conclusion "cancelled"}}Cancelled{{else}}{{.Conclusion}}{{end}}"
                               class="check-dot tooltip-dot {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}running{{else if or (eq .Conclusion "failure") (eq .Conclusion "timed_out") (eq .Conclusion "action_required") (eq .Conclusion "cancelled")}}failure{{else if eq .Conclusion "success"}}success{{else}}neutral{{end}}">
                            </a>
                            {{end}}
                        </div>
                        <span class="checks-summary">
                            {{if gt .ChecksSuccess 0}}<span class="check-count success">{{.ChecksSuccess}} passed</span>{{end}}
                            {{if gt .ChecksFailure 0}}<span class="check-count failure">{{.ChecksFailure}} failed</span>{{end}}
                            {{if gt .ChecksRunning 0}}<span class="check-count running">{{.ChecksRunning}} running</span>{{end}}
                        </span>
                    </div>
                    {{end}}
                </td>
                <td data-label="Author" class="col-author">
                    <div class="author-info">
                        <img src="{{.AuthorAvatar}}?s=48" alt="" class="author-avatar" loading="lazy" width="24" height="24">
                        <a href="https://github.com/{{.Author}}" target="_blank" rel="noopener noreferrer">{{.Author}}</a>
                        {{if .IsExternal}}
                        <span class="external-badge" title="Not a repository owner, member, or collaborator">external</span>
                        {{end}}
                    </div>
                </td>
                <td data-label="Branch" class="branch-info col-branch">
                    <span title="{{.BaseBranch}} &#8592; {{.HeadBranch}}">{{.BaseBranch}} &#8592; {{.HeadBranch}}</span>
                </td>
                <td data-label="Review">
                    <div class="review-status {{.ReviewStatus}}">
                        {{if eq .ReviewStatus "approved"}}Approved
                        {{else if eq .ReviewStatus "changes_requested"}}Changes
                        {{else}}Pending{{end}}
                    </div>
                    {{if .Reviewers}}
                    <div class="reviewers">
                        {{range .Reviewers}}
                        <img src="{{.Avatar}}?s=40" alt="{{.Login}}: {{.State}}" title="{{.Login}}: {{.State}}" loading="lazy"
                             class="reviewer-avatar {{if eq .State "APPROVED"}}approved{{else if eq .State "CHANGES_REQUESTED"}}changes{{end}}" width="20" height="20">
                        {{end}}
                    </div>
                    {{end}}
                </td>
                <td data-label="Merge Status">
                    <span class="merge-status {{.MergeableState}}">
                        {{if eq .MergeableState "clean"}}Ready
                        {{else if eq .MergeableState "blocked"}}Blocked
                        {{else if eq .MergeableState "dirty"}}Conflicts
                        {{else}}{{.MergeableState}}{{end}}
                    </span>
                </td>
                <td data-label="Updated" class="time" title="Created: {{.CreatedAt.Format "Jan 2, 2006"}}">{{.UpdatedAt.Format "Jan 2, 2006"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

{{end}}

{{if gt .TotalPages 1}}
<div class="pagination">
    {{if gt .CurrentPage 1}}
        <a href="?sort={{.Sort}}&order={{.Order}}&page=1&repo={{.Repo}}">&#171; First</a>
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.CurrentPage | add -1}}&repo={{.Repo}}">&#8249; Previous</a>
    {{else}}
        <span class="pagination-disabled">&#171; First</span>
        <span class="pagination-disabled">&#8249; Previous</span>
    {{end}}

    <span class="pagination-info">Page {{.CurrentPage}} of {{.TotalPages}}</span>

    {{if lt .CurrentPage .TotalPages}}
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.CurrentPage | add 1}}&repo={{.Repo}}">Next &#8250;</a>
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.TotalPages}}&repo={{.Repo}}">Last &#187;</a>
    {{else}}
        <span class="pagination-disabled">Next &#8250;</span>
        <span class="pagination-disabled">Last &#187;</span>
    {{end}}
</div>
{{end}}
{{end}}
