{{define "tv-branch-section"}}
<div class="branch-section {{if .IsMain}}branch-main{{else if eq .Branch "develop"}}branch-develop{{else}}branch-other{{end}} {{if and (eq .FailureCount 0) (eq .RunningCount 0) .HasChecks}}all-passed{{end}} {{if gt .FailureCount 0}}has-failures{{end}}">
    <div class="branch-header">
        <span class="branch-name">{{.Branch}}</span>
        <div class="branch-summary">
            <span class="summary-count count-success{{if eq .SuccessCount 0}} count-zero{{end}}">{{.SuccessCount}} passed</span>
            <span class="summary-count count-failure{{if eq .FailureCount 0}} count-zero{{end}}">{{.FailureCount}} failed</span>
            <span class="summary-count count-running{{if eq .RunningCount 0}} count-zero{{end}}">{{.RunningCount}} running</span>
        </div>
    </div>
    {{if .HasChecks}}
        {{if and (eq .FailureCount 0) (eq .RunningCount 0)}}
        <div class="branch-success">
            <span class="summary-pill pill-success">{{affirm}}</span>
        </div>
        {{end}}
        {{if gt .FailureCount 0}}
        <ul class="failure-list">
            {{range .Checks}}
                {{if or (eq .Conclusion "failure") (eq .Conclusion "timed_out") (eq .Conclusion "action_required") (eq .Conclusion "cancelled")}}
                <li class="failure-item">
                    <span class="failure-indicator"></span>
                    <span class="failure-name">{{.Name}}</span>
                </li>
                {{end}}
            {{end}}
        </ul>
        {{end}}
        {{if gt .RunningCount 0}}
        <ul class="running-list">
            {{range .Checks}}
                {{if or (eq .Status "in_progress") (eq .Status "queued") (eq .Status "waiting") (eq .Status "pending")}}
                <li class="running-item">
                    <span class="running-indicator"></span>
                    <span class="running-name">{{.Name}}</span>
                </li>
                {{end}}
            {{end}}
        </ul>
        {{end}}
    {{else}}
    <div class="no-runs">&mdash;</div>
    {{end}}
</div>
{{end}}

<!DOCTYPE html>
<html lang="en" class="tv-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Organization}} — Build Status Dashboard</title>
    <link rel="stylesheet" href="static/base.css">
    <link rel="stylesheet" href="static/tv.css">
</head>
<body>
    <div class="tv-container">
        <div class="tv-status-bar">
            <span>{{.Organization}} — Build Status</span>
            <div class="tv-status-right">
                <span>Updated {{.LastUpdate.Format "15:04:05"}}</span>
                <span class="tv-countdown" id="tv-countdown"></span>
            </div>
        </div>
        {{if .StaleRepoList}}
        <div class="stale-banner" role="alert">
            &#9888; Data may be outdated for: {{range $i, $name := .StaleRepoList}}{{if $i}}, {{end}}{{$name}}{{end}}
        </div>
        {{end}}
        <main class="tv-main">
            {{if not .Repositories}}
            <div class="empty-state">
                <p>No build status data available yet.</p>
            </div>
            {{else}}
            <div class="build-cards">
                {{range .Repositories}}
                <div class="build-card{{if .Stale}} stale-card{{end}}">
                    <div class="card-header">
                        <h3 class="repo-name">{{.Name}}</h3>
                    </div>
                    {{range .Branches}}
                    {{template "tv-branch-section" .}}
                    {{end}}
                </div>
                {{end}}
            </div>
            {{end}}
        </main>
    </div>
    <script src="static/dashboard.js"></script>
</body>
</html>
