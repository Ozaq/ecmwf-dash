{{define "title"}}Issues{{end}}

{{define "extra-css"}}{{end}}

{{define "stats"}}
<div class="stats">
    Last updated: {{.LastUpdate.Format "Jan 2, 15:04:05 MST"}} |
    Total issues: {{.TotalIssues}} |
    Showing {{if .Issues}}{{add (mul (add .CurrentPage -1) 100) 1}}-{{add (mul (add .CurrentPage -1) 100) (len .Issues)}}{{else}}0{{end}} of {{.TotalIssues}}
</div>
{{if .RepoNames}}
<form class="filter-form" id="repo-filter-form" method="get">
    <input type="hidden" name="sort" value="{{.Sort}}">
    <input type="hidden" name="order" value="{{.Order}}">
    <label for="repo-filter" class="sr-only">Filter by repository</label>
    <select id="repo-filter" name="repo">
        <option value="">All repositories</option>
        {{range .RepoNames}}
        <option value="{{.}}"{{if eq . $.Repo}} selected{{end}}>{{.}}</option>
        {{end}}
    </select>
</form>
{{end}}
{{end}}

{{define "content"}}
{{if eq .TotalIssues 0}}
<div class="empty-state">
    <p>No open issues found across monitored repositories.</p>
    {{if .LastUpdate.IsZero}}<p class="empty-state-hint">Data is still loading. Check back shortly.</p>{{end}}
</div>
{{else}}
<div class="issues-table">
    <table>
        <caption class="sr-only">Open issues across repositories</caption>
        <thead>
            <tr>
                <th scope="col" aria-sort="{{if eq .Sort "repo"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=repo&order={{if and (eq .Sort "repo") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Repository
                        <span class="sort-arrow {{if eq .Sort "repo"}}active{{end}}">
                            {{if and (eq .Sort "repo") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "repo") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "number"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=number&order={{if and (eq .Sort "number") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        #
                        <span class="sort-arrow {{if eq .Sort "number"}}active{{end}}">
                            {{if and (eq .Sort "number") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "number") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "title"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=title&order={{if and (eq .Sort "title") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Title
                        <span class="sort-arrow {{if eq .Sort "title"}}active{{end}}">
                            {{if and (eq .Sort "title") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "title") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "author"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=author&order={{if and (eq .Sort "author") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Author
                        <span class="sort-arrow {{if eq .Sort "author"}}active{{end}}">
                            {{if and (eq .Sort "author") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "author") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "updated"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=updated&order={{if and (eq .Sort "updated") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Last Activity
                        <span class="sort-arrow {{if eq .Sort "updated"}}active{{end}}">
                            {{if and (eq .Sort "updated") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "updated") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
                <th scope="col" aria-sort="{{if eq .Sort "created"}}{{if eq .Order "asc"}}ascending{{else}}descending{{end}}{{else}}none{{end}}">
                    <a href="?sort=created&order={{if and (eq .Sort "created") (eq .Order "asc")}}desc{{else}}asc{{end}}&page={{.CurrentPage}}&repo={{.Repo}}">
                        Created
                        <span class="sort-arrow {{if eq .Sort "created"}}active{{end}}">
                            {{if and (eq .Sort "created") (eq .Order "asc")}}&#8593;{{else if and (eq .Sort "created") (eq .Order "desc")}}&#8595;{{else}}&#8597;{{end}}
                        </span>
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
            {{range .Issues}}
            <tr{{if index $.StaleRepos .Repository}} class="stale-row"{{end}}>
                <td data-label="Repository">{{.Repository}}</td>
                <td data-label="#" class="issue-number">#{{.Number}}</td>
                <td data-label="Title">
                    <div>
                        <a href="{{.URL}}" target="_blank" rel="noopener noreferrer">{{.Title}}</a>
                    </div>
                    {{if .Labels}}
                    <div class="labels">
                        {{range .Labels}}
                        <span class="label" style="{{.LabelStyle}}">{{.Name}}</span>
                        {{end}}
                    </div>
                    {{end}}
                </td>
                <td data-label="Author">
                    <div class="author-info">
                        <img src="{{.AuthorAvatar}}?s=48" alt="" class="author-avatar" loading="lazy" width="24" height="24">
                        <a href="https://github.com/{{.Author}}" target="_blank" rel="noopener noreferrer">{{.Author}}</a>
                        {{if .IsExternal}}
                        <span class="external-badge" title="Not a repository owner, member, or collaborator">external</span>
                        {{end}}
                    </div>
                </td>
                <td data-label="Updated" class="time">{{.UpdatedAt.Format "Jan 2, 2006"}}</td>
                <td data-label="Created" class="time">{{.CreatedAt.Format "Jan 2, 2006"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

{{end}}

{{if gt .TotalPages 1}}
<div class="pagination">
    {{if gt .CurrentPage 1}}
        <a href="?sort={{.Sort}}&order={{.Order}}&page=1&repo={{.Repo}}">&#171; First</a>
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.CurrentPage | add -1}}&repo={{.Repo}}">&#8249; Previous</a>
    {{else}}
        <span class="pagination-disabled">&#171; First</span>
        <span class="pagination-disabled">&#8249; Previous</span>
    {{end}}

    <span class="pagination-info">Page {{.CurrentPage}} of {{.TotalPages}}</span>

    {{if lt .CurrentPage .TotalPages}}
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.CurrentPage | add 1}}&repo={{.Repo}}">Next &#8250;</a>
        <a href="?sort={{.Sort}}&order={{.Order}}&page={{.TotalPages}}&repo={{.Repo}}">Last &#187;</a>
    {{else}}
        <span class="pagination-disabled">Next &#8250;</span>
        <span class="pagination-disabled">Last &#187;</span>
    {{end}}
</div>
{{end}}
{{end}}
